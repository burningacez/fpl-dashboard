<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon-192.png">
    <link rel="manifest" href="/manifest.json">
    <title>Animation Test - FPL League</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        .animation-section {
            margin-bottom: 3rem;
        }
        .animation-section h2 {
            color: var(--accent);
            font-size: 1.3rem;
            margin-bottom: 0.25rem;
        }
        .animation-section .description {
            color: var(--gray-400);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        .shuffle-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent);
            color: var(--primary);
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1rem;
        }
        .shuffle-btn:hover {
            background: var(--accent-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-glow);
        }
        .shuffle-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* All test tables share this structure */
        .test-table-container {
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            background: var(--gray-900);
            border: 1px solid rgba(0, 255, 135, 0.2);
            overflow: hidden;
        }
        .test-table-container table {
            width: 100%;
            border-collapse: collapse;
            background: var(--gray-900);
        }
        .test-table-container th {
            background: var(--gray-900);
            color: var(--accent);
            padding: var(--space-4) var(--space-3);
            text-align: center;
            font-weight: 700;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-bottom: 2px solid var(--accent);
        }
        .test-table-container td {
            padding: var(--space-3) var(--space-3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            font-size: 0.85rem;
        }
        .test-table-container th:first-child,
        .test-table-container td:first-child {
            text-align: center;
            width: 50px;
        }
        .test-table-container th:nth-child(2),
        .test-table-container td:nth-child(2) {
            text-align: left;
            padding-left: var(--space-4);
        }
        .test-table-container tbody tr:nth-child(even) td {
            background: rgba(0, 0, 0, 0.2);
        }

        /* Rank styling */
        .rank-cell {
            font-weight: 800;
            font-size: 1rem;
        }
        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }

        /* Movement indicators */
        .move-up { color: var(--accent); font-size: 0.7rem; }
        .move-down { color: var(--danger); font-size: 0.7rem; }
        .move-same { color: var(--gray-500); font-size: 0.7rem; }

        /* ================================================================
           ANIMATION 1: 3D Lift & Slide
           Row lifts towards the viewer with scale + shadow, slides to
           new position, then settles back down.
           ================================================================ */
        #table1 tbody {
            position: relative;
        }
        #table1 tbody tr {
            transition: none;
            will-change: transform, box-shadow;
        }
        #table1 tbody tr.anim1-lift {
            position: relative;
            z-index: 20;
            animation: anim1Lift var(--anim-duration, 800ms) cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes anim1Lift {
            0% {
                transform: scale(1) translateY(0);
                box-shadow: none;
            }
            25% {
                transform: scale(1.04) translateY(0);
                box-shadow: 0 8px 30px rgba(0, 255, 135, 0.3), 0 0 0 1px rgba(0, 255, 135, 0.15);
            }
            75% {
                transform: scale(1.04) translateY(var(--move-y));
                box-shadow: 0 8px 30px rgba(0, 255, 135, 0.3), 0 0 0 1px rgba(0, 255, 135, 0.15);
            }
            100% {
                transform: scale(1) translateY(var(--move-y));
                box-shadow: none;
            }
        }

        /* ================================================================
           ANIMATION 2: Pop & Float
           Row pops out with a quick scale burst, floats to new position
           with a gentle ease, and fades back in place.
           ================================================================ */
        #table2 tbody tr {
            transition: none;
            will-change: transform, opacity;
        }
        #table2 tbody tr.anim2-pop {
            position: relative;
            z-index: 20;
            animation: anim2Pop var(--anim-duration, 900ms) ease-in-out forwards;
        }
        @keyframes anim2Pop {
            0% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
            15% {
                transform: scale(1.08) translateY(0);
                opacity: 1;
            }
            30% {
                transform: scale(1.08) translateY(0);
                opacity: 0.95;
            }
            85% {
                transform: scale(1.03) translateY(var(--move-y));
                opacity: 0.95;
            }
            100% {
                transform: scale(1) translateY(var(--move-y));
                opacity: 1;
            }
        }

        /* ================================================================
           ANIMATION 3: Card Flip & Glide
           Row flips slightly in 3D as it lifts forward (rotateX),
           then glides to new position while unflipping.
           ================================================================ */
        #table3 {
            perspective: 1000px;
        }
        #table3 tbody tr {
            transition: none;
            will-change: transform;
            transform-style: preserve-3d;
        }
        #table3 tbody tr.anim3-flip {
            position: relative;
            z-index: 20;
            animation: anim3Flip var(--anim-duration, 1000ms) cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        @keyframes anim3Flip {
            0% {
                transform: rotateX(0deg) scale(1) translateY(0) translateZ(0);
            }
            20% {
                transform: rotateX(-8deg) scale(1.03) translateY(0) translateZ(40px);
            }
            50% {
                transform: rotateX(-4deg) scale(1.03) translateY(calc(var(--move-y) * 0.5)) translateZ(30px);
            }
            80% {
                transform: rotateX(-2deg) scale(1.01) translateY(var(--move-y)) translateZ(10px);
            }
            100% {
                transform: rotateX(0deg) scale(1) translateY(var(--move-y)) translateZ(0);
            }
        }

        /* ================================================================
           ANIMATION 4: Bounce Forward & Settle
           Row springs forward with an elastic feel, moves to new
           position, and bounces slightly on landing.
           ================================================================ */
        #table4 tbody tr {
            transition: none;
            will-change: transform, box-shadow;
        }
        #table4 tbody tr.anim4-bounce {
            position: relative;
            z-index: 20;
            animation: anim4Bounce var(--anim-duration, 1000ms) cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        #table4 tbody tr.anim4-bounce td {
            background: rgba(0, 255, 135, 0.05);
        }
        @keyframes anim4Bounce {
            0% {
                transform: scale(1) translateY(0);
                box-shadow: none;
            }
            20% {
                transform: scale(1.06) translateY(0);
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            }
            60% {
                transform: scale(1.06) translateY(var(--move-y));
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            }
            80% {
                transform: scale(0.98) translateY(var(--move-y));
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            }
            90% {
                transform: scale(1.02) translateY(var(--move-y));
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            }
            100% {
                transform: scale(1) translateY(var(--move-y));
                box-shadow: none;
            }
        }

        /* ================================================================
           ANIMATION 5: Glow Trail & Shift
           Row glows with accent color as it lifts, leaves a fading
           "ghost" at the old position, slides to new position.
           ================================================================ */
        #table5 tbody tr {
            transition: none;
            will-change: transform, box-shadow;
        }
        #table5 tbody tr.anim5-glow {
            position: relative;
            z-index: 20;
            animation: anim5Glow var(--anim-duration, 900ms) ease-in-out forwards;
        }
        #table5 tbody tr.anim5-glow td {
            transition: background 200ms, color 200ms;
            background: rgba(0, 255, 135, 0.08) !important;
        }
        @keyframes anim5Glow {
            0% {
                transform: scale(1) translateY(0);
                box-shadow: none;
                filter: brightness(1);
            }
            20% {
                transform: scale(1.05) translateY(0);
                box-shadow: 0 0 25px rgba(0, 255, 135, 0.4), 0 0 60px rgba(0, 255, 135, 0.15), inset 0 0 20px rgba(0, 255, 135, 0.05);
                filter: brightness(1.2);
            }
            40% {
                transform: scale(1.05) translateY(calc(var(--move-y) * 0.3));
                box-shadow: 0 0 20px rgba(0, 255, 135, 0.35), 0 0 50px rgba(0, 255, 135, 0.1);
                filter: brightness(1.15);
            }
            80% {
                transform: scale(1.02) translateY(var(--move-y));
                box-shadow: 0 0 10px rgba(0, 255, 135, 0.2);
                filter: brightness(1.05);
            }
            100% {
                transform: scale(1) translateY(var(--move-y));
                box-shadow: none;
                filter: brightness(1);
            }
        }
        /* Ghost row left behind */
        .ghost-row {
            position: absolute;
            left: 0;
            right: 0;
            pointer-events: none;
            opacity: 0.3;
            animation: ghostFade 600ms ease-out forwards;
        }
        .ghost-row td {
            background: rgba(0, 255, 135, 0.05) !important;
            border-color: transparent !important;
        }
        @keyframes ghostFade {
            0% { opacity: 0.3; }
            100% { opacity: 0; }
        }

        /* Speed control */
        .controls-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .speed-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray-400);
            font-size: 0.8rem;
        }
        .speed-control input[type="range"] {
            width: 120px;
            accent-color: var(--accent);
        }
        .speed-label {
            color: var(--accent);
            font-weight: 600;
            min-width: 50px;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="navbar-inner">
            <a href="/" class="navbar-brand"><img src="/favicon.png" alt="">Barry's FPL Mini League</a>
            <button class="nav-toggle" onclick="this.classList.toggle('active');document.querySelector('.navbar-links').classList.toggle('active')">
                <span></span><span></span><span></span>
            </button>
            <div class="navbar-links">
                <a href="/">Home</a>
                <a href="/week">Scores</a>
                <a href="/losers">Weekly Losers</a>
                <a href="/motm">MotM</a>
                <a href="/chips">Chips</a>
                <a href="/earnings">Earnings</a>
                <a href="/cup">Cup</a>
                <a href="/hall-of-fame">Hall of Fame</a>
                <a href="/set-and-forget">Set & Forget</a>
                <a href="/rules">Rules</a>
            </div>
        </div>
    </nav>

    <div class="page-header">
        <h1>Animation Test Lab</h1>
        <p class="subtitle">Row position change animations &mdash; pick your favourite</p>
    </div>

    <main>
        <!-- Animation 1 -->
        <div class="animation-section">
            <h2>1. 3D Lift & Slide</h2>
            <p class="description">Row scales up towards the viewer with a glow shadow, slides to its new position, then settles back flush.</p>
            <div class="controls-row">
                <button class="shuffle-btn" onclick="shuffleTable('table1', 'anim1-lift')">Shuffle Positions</button>
                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" min="400" max="1600" value="800" step="100" oninput="setSpeed('table1', this.value)">
                    <span class="speed-label" id="speed-table1">800ms</span>
                </div>
            </div>
            <div class="test-table-container">
                <table id="table1"><thead></thead><tbody></tbody></table>
            </div>
        </div>

        <!-- Animation 2 -->
        <div class="animation-section">
            <h2>2. Pop & Float</h2>
            <p class="description">Row pops out with a quick scale burst, floats gently to its new position, and eases back into place.</p>
            <div class="controls-row">
                <button class="shuffle-btn" onclick="shuffleTable('table2', 'anim2-pop')">Shuffle Positions</button>
                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" min="400" max="1600" value="900" step="100" oninput="setSpeed('table2', this.value)">
                    <span class="speed-label" id="speed-table2">900ms</span>
                </div>
            </div>
            <div class="test-table-container">
                <table id="table2"><thead></thead><tbody></tbody></table>
            </div>
        </div>

        <!-- Animation 3 -->
        <div class="animation-section">
            <h2>3. Card Flip & Glide</h2>
            <p class="description">Row tilts forward in 3D perspective (rotateX) as it lifts, glides to the new position while gradually unflipping.</p>
            <div class="controls-row">
                <button class="shuffle-btn" onclick="shuffleTable('table3', 'anim3-flip')">Shuffle Positions</button>
                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" min="400" max="1600" value="1000" step="100" oninput="setSpeed('table3', this.value)">
                    <span class="speed-label" id="speed-table3">1000ms</span>
                </div>
            </div>
            <div class="test-table-container">
                <table id="table3"><thead></thead><tbody></tbody></table>
            </div>
        </div>

        <!-- Animation 4 -->
        <div class="animation-section">
            <h2>4. Bounce Forward & Settle</h2>
            <p class="description">Row springs forward with elastic easing, moves to new position, overshoots slightly and bounces on landing.</p>
            <div class="controls-row">
                <button class="shuffle-btn" onclick="shuffleTable('table4', 'anim4-bounce')">Shuffle Positions</button>
                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" min="400" max="1600" value="1000" step="100" oninput="setSpeed('table4', this.value)">
                    <span class="speed-label" id="speed-table4">1000ms</span>
                </div>
            </div>
            <div class="test-table-container">
                <table id="table4"><thead></thead><tbody></tbody></table>
            </div>
        </div>

        <!-- Animation 5 -->
        <div class="animation-section">
            <h2>5. Glow Trail & Shift</h2>
            <p class="description">Row glows with neon accent light as it lifts forward, leaves a fading ghost at the old position, and slides to the new spot.</p>
            <div class="controls-row">
                <button class="shuffle-btn" onclick="shuffleTable('table5', 'anim5-glow')">Shuffle Positions</button>
                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" min="400" max="1600" value="900" step="100" oninput="setSpeed('table5', this.value)">
                    <span class="speed-label" id="speed-table5">900ms</span>
                </div>
            </div>
            <div class="test-table-container">
                <table id="table5"><thead></thead><tbody></tbody></table>
            </div>
        </div>
    </main>

<script>
// =====================================================================
// Mock FPL-style data
// =====================================================================
const managers = [
    { name: 'Barry', team: 'Barry Manilow FC', pts: 1842, gw: 67 },
    { name: 'Craig', team: 'Craig David XI', pts: 1798, gw: 54 },
    { name: 'Damo', team: 'Damo United', pts: 1775, gw: 71 },
    { name: 'Liam', team: 'Liampool', pts: 1763, gw: 48 },
    { name: 'Fionn', team: 'Fionn Baller', pts: 1751, gw: 62 },
    { name: 'Oisin', team: 'Oisin the Dream', pts: 1740, gw: 59 },
    { name: 'Rory', team: 'Rory Rovers', pts: 1728, gw: 44 },
    { name: 'Kevin', team: 'Kev FC', pts: 1715, gw: 73 },
    { name: 'Niall', team: 'Niall or Nothing', pts: 1703, gw: 51 },
    { name: 'Sean', team: 'Sean Dynamo', pts: 1690, gw: 38 },
];

// Per-table state: current ordering of manager indices
const tableStates = {};
const tableSpeeds = {};
const animating = {};

// =====================================================================
// Initialise all five tables with the same data, different orderings
// =====================================================================
function initTables() {
    for (let i = 1; i <= 5; i++) {
        const id = `table${i}`;
        tableStates[id] = managers.map((_, idx) => idx); // initial order 0..9
        tableSpeeds[id] = parseInt(document.querySelector(`#speed-${id}`)?.textContent) || 800;
        animating[id] = false;
        renderTable(id);
    }
}

function renderTable(tableId) {
    const table = document.getElementById(tableId);
    const thead = table.querySelector('thead');
    const tbody = table.querySelector('tbody');
    const order = tableStates[tableId];

    thead.innerHTML = `<tr>
        <th>#</th>
        <th>Manager</th>
        <th>Team</th>
        <th>GW Pts</th>
        <th>Total</th>
        <th>Move</th>
    </tr>`;

    tbody.innerHTML = order.map((mIdx, pos) => {
        const m = managers[mIdx];
        const rankClass = pos < 3 ? ` rank-${pos + 1}` : '';
        return `<tr data-manager="${mIdx}">
            <td class="rank-cell${rankClass}">${pos + 1}</td>
            <td>${m.name}</td>
            <td style="color: var(--gray-400); font-size:0.8rem">${m.team}</td>
            <td style="font-weight:700">${m.gw}</td>
            <td style="font-weight:600">${m.pts}</td>
            <td class="move-same">-</td>
        </tr>`;
    }).join('');
}

// =====================================================================
// Speed control
// =====================================================================
function setSpeed(tableId, ms) {
    tableSpeeds[tableId] = parseInt(ms);
    document.getElementById(`speed-${tableId}`).textContent = ms + 'ms';
}

// =====================================================================
// Core shuffle logic with animation
// =====================================================================
function shuffleTable(tableId, animClass) {
    if (animating[tableId]) return;
    animating[tableId] = true;

    const table = document.getElementById(tableId);
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const oldOrder = [...tableStates[tableId]];

    // Generate new random order (Fisher-Yates)
    const newOrder = [...oldOrder];
    for (let i = newOrder.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newOrder[i], newOrder[j]] = [newOrder[j], newOrder[i]];
    }

    // Build map: managerIndex -> old position index
    const oldPosMap = {};
    oldOrder.forEach((mIdx, pos) => { oldPosMap[mIdx] = pos; });

    // Build map: managerIndex -> new position index
    const newPosMap = {};
    newOrder.forEach((mIdx, pos) => { newPosMap[mIdx] = pos; });

    // Measure row height
    const rowHeight = rows[0]?.offsetHeight || 45;
    const duration = tableSpeeds[tableId];

    // Disable button during animation
    const btn = table.closest('.animation-section').querySelector('.shuffle-btn');
    btn.disabled = true;

    // For each row, calculate how many positions it needs to move
    rows.forEach((row) => {
        const mIdx = parseInt(row.dataset.manager);
        const oldPos = oldPosMap[mIdx];
        const newPos = newPosMap[mIdx];
        const delta = newPos - oldPos;

        if (delta === 0) return; // no move needed

        const moveY = delta * rowHeight;
        row.style.setProperty('--move-y', `${moveY}px`);
        row.style.setProperty('--anim-duration', `${duration}ms`);

        // For animation 5: add ghost row at old position
        if (animClass === 'anim5-glow') {
            const ghost = row.cloneNode(true);
            ghost.classList.add('ghost-row');
            ghost.style.top = `${row.offsetTop}px`;
            ghost.style.height = `${rowHeight}px`;
            tbody.style.position = 'relative';
            tbody.appendChild(ghost);
            setTimeout(() => ghost.remove(), 700);
        }

        // Update move indicator
        const moveCell = row.querySelector('td:last-child');
        if (delta < 0) {
            moveCell.className = 'move-up';
            moveCell.textContent = `+${Math.abs(delta)}`;
        } else {
            moveCell.className = 'move-down';
            moveCell.textContent = `${-Math.abs(delta)}`;
        }

        row.classList.add(animClass);
    });

    // After animation completes, re-render with new order
    setTimeout(() => {
        // Remove animation classes
        rows.forEach(r => {
            r.classList.remove(animClass);
            r.style.removeProperty('--move-y');
            r.style.removeProperty('--anim-duration');
        });

        tableStates[tableId] = newOrder;
        renderTable(tableId);
        animating[tableId] = false;
        btn.disabled = false;
    }, duration + 50);
}

// =====================================================================
// Init
// =====================================================================
document.addEventListener('DOMContentLoaded', initTables);
</script>
</body>
</html>
